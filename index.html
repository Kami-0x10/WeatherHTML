<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天気情報</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f0f0f0;
        }
        
        h1 {
            text-align: center;
            font-size: 24px;
            color: #333;
        }

        .weather {
            margin-top: 20px;
            text-align: center;
        }

        .weather p {
            font-size: 18px;
            margin: 10px 0;
            color: #333;
        }

        .weather-icon {
            width: 50px;
            height: 50px;
            display: block;
            margin: 0 auto;
        }

        /* アイコンのサイズと配置 */
        .weather-icon.sunny {
            background: url('https://www.iconfinder.com/icons/414849/sun_weather_icon') no-repeat center center;
            background-size: contain;
        }

        .weather-icon.cloudy {
            background: url('https://www.iconfinder.com/icons/414850/cloud_weather_icon') no-repeat center center;
            background-size: contain;
        }

        .weather-icon.rainy {
            background: url('https://www.iconfinder.com/icons/414851/rain_weather_icon') no-repeat center center;
            background-size: contain;
        }

        /* iOS6対応のレスポンシブデザイン */
        @media only screen and (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <h1>天気情報</h1>

    <div class="weather">
        <p id="location"></p>
        <p id="temp"></p>
        <p id="forecast"></p>
        <div id="weather-icon" class="weather-icon"></div>
    </div>

    <script>
        // ページがロードされたら自動で位置情報を取得
        window.onload = function() {
            getLocation();
        };

        function getLocation() {
            if (navigator.geolocation) {
                // 位置情報を取得
                navigator.geolocation.getCurrentPosition(showWeather, showError);
            } else {
                alert("このブラウザでは位置情報がサポートされていません。");
            }
        }

        function showWeather(position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;
            getWeather(lat, lon);
        }

        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    alert("位置情報の取得が拒否されました。");
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert("位置情報が利用できません。");
                    break;
                case error.TIMEOUT:
                    alert("位置情報の取得がタイムアウトしました。");
                    break;
                case error.UNKNOWN_ERROR:
                    alert("不明なエラーが発生しました。");
                    break;
            }
        }

        function getWeather(lat, lon) {
            // 位置情報を使って天気情報を取得
            var apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=YOUR_API_KEY&lang=ja&units=metric`;
            
            var xhr = new XMLHttpRequest();
            xhr.open('POST', apiUrl, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    try {
                        // JSONデータをパース
                        var data = JSON.parse(xhr.responseText);

                        // 取得したデータから必要な情報を抽出
                        var location = data.name; // 地名
                        var temp = "気温: " + data.main.temp + "°C"; // 温度
                        var forecast = data.weather[0].description; // 天気の説明
                        var icon = data.weather[0].icon; // 天気アイコン

                        // アイコンのURL
                        var iconUrl = `http://openweathermap.org/img/wn/${icon}@2x.png`;

                        // HTMLに表示
                        document.getElementById('location').textContent = '場所: ' + location;
                        document.getElementById('forecast').textContent = '天気: ' + forecast;
                        document.getElementById('temp').textContent = temp;
                        document.getElementById('weather-icon').style.backgroundImage = `url(${iconUrl})`;

                    } catch (error) {
                        console.error('エラーが発生しました:', error);
                        alert('天気情報の取得に失敗しました。');
                    }
                }
            };
            xhr.send();
        }
    </script>
</body>
</html>
